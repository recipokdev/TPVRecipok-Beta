<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>TPV Local Recipok</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="products-area">
      <!-- Barra de agentes (principal) -->
      <div id="mainAgentBar" class="agent-main-bar"></div>

      <!-- Barra de b√∫squeda -->
      <div class="search-bar">
        <input
          id="searchInput"
          type="text"
          placeholder="Buscar producto..."
          autocomplete="off"
        />
        <button id="searchClearBtn" class="search-btn">‚úï</button>
        <button id="searchKeyboardBtn" class="search-btn">‚å®</button>
      </div>

      <!-- Categor√≠as con flechas -->
      <div class="categories-wrapper">
        <div id="categories" class="categories"></div>
      </div>

      <!-- Productos -->
      <div class="products-grid" id="productsGrid"></div>
      <div id="statusBar" style="display: flex; align-items: center; gap: 6px">
        <span
          id="statusDot"
          style="
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #22c55e; /* verde por defecto */
            display: inline-block;
          "
        ></span>
        <strong>Online Recipok</strong>
      </div>
    </div>

    <!-- PANEL DERECHO: CARRITO -->
    <aside class="cart-card">
      <header class="cart-card-header">
        <div class="cart-title">üõí <span>Carrito</span></div>
        <div class="cart-header-right">
          <button type="button" class="cart-header-box" id="cashHeaderBtn">
            üí∂ <span id="cashHeaderLabel">Abrir caja</span>
          </button>

          <!-- NUEVO: bot√≥n de movimientos de caja -->
          <button
            type="button"
            class="cart-header-box"
            id="cashMoveBtn"
            title="Movimientos de caja"
          >
            üí∏ <span>Mov.</span>
          </button>

          <button
            type="button"
            class="cart-header-box"
            id="optionsBtn"
            title="Opciones"
          >
            ‚öôÔ∏è
          </button>
        </div>
      </header>

      <!-- Info terminal / agente -->
      <div class="cart-terminal-row">
        <span>
          Terminal: <strong id="terminalName">---</strong>
          &nbsp;|&nbsp; Agente:
          <span id="agentName" class="agent-name">---</span>
          &nbsp;|&nbsp; Usuario:
          <span
            id="userName"
            class="agent-name user-name"
            title="Cerrar sesi√≥n"
          >
            ---
          </span>
        </span>
      </div>

      <!-- Cliente actual (por ahora solo texto fijo, luego lo conectamos) -->
      <div class="cart-client-row">
        <div class="cart-client-icon">üë§</div>
        <input
          type="text"
          class="cart-client-input"
          value="1 | Ventas tickets"
          readonly
        />
        <button type="button" class="cart-client-btn" title="Cambiar cliente">
          ‚ûï
        </button>
      </div>

      <!-- L√çNEAS DEL CARRITO -->
      <div class="cart-lines-wrapper">
        <div id="cartLines"></div>
      </div>

      <!-- TOTAL -->
      <div class="cart-total-row">
        <span>Total</span>
        <span id="totalAmount">0,00 ‚Ç¨</span>
      </div>

      <!-- BOTONERA INFERIOR (nuevo layout) -->
      <div class="cart-action-grid">
        <!-- Izquierda -->
        <button id="clearCartBtn" class="cart-btn cart-btn-delete">
          Vaciar
        </button>
        <button id="ticketsListBtn" class="cart-btn cart-btn-tickets">
          Tickets
        </button>

        <!-- Centro (el ‚Äúhueco‚Äù donde antes estaba imprimir) -->
        <button id="parkBtn" class="cart-btn cart-btn-park">Aparcar</button>
        <button id="parkedListBtn" class="cart-btn cart-btn-parked">
          Aparcados <span id="parkedCountBadge" class="cart-badge">0</span>
        </button>

        <!-- Derecha: Cobrar ocupa 2 filas -->
        <button id="payBtn" class="cart-btn cart-btn-pay cart-btn-pay-tall">
          Cobrar
        </button>
      </div>
    </aside>

    <!-- Puedes dejar esto tal cual si lo usas en Opciones -->
    <button id="changePrinterBtn" class="cart-btn hidden">Impresora</button>

    <!-- Teclado num√©rico -->
    <div id="numPadOverlay" class="num-pad-overlay hidden">
      <div class="num-pad">
        <div class="num-pad-title">
          Cantidad <span id="numPadProductName"></span>
        </div>
        <div id="numPadDisplay" class="num-pad-display">0</div>
        <div class="num-pad-grid calc-grid">
          <button class="num-pad-btn" data-key="7">7</button>
          <button class="num-pad-btn" data-key="8">8</button>
          <button class="num-pad-btn" data-key="9">9</button>
          <button class="num-pad-btn op" data-key="/">√∑</button>

          <button class="num-pad-btn" data-key="4">4</button>
          <button class="num-pad-btn" data-key="5">5</button>
          <button class="num-pad-btn" data-key="6">6</button>
          <button class="num-pad-btn op" data-key="*">√ó</button>

          <button class="num-pad-btn" data-key="1">1</button>
          <button class="num-pad-btn" data-key="2">2</button>
          <button class="num-pad-btn" data-key="3">3</button>
          <button class="num-pad-btn op" data-key="-">‚àí</button>

          <button class="num-pad-btn" data-key="0">0</button>
          <button class="num-pad-btn" data-key=".">.</button>
          <button class="num-pad-btn" data-key="back">‚å´</button>
          <button class="num-pad-btn op" data-key="+">+</button>
        </div>

        <div class="num-pad-actions">
          <button class="num-pad-clear" data-key="clear">Borrar</button>
          <button class="num-pad-cancel" data-key="cancel">Cancelar</button>
          <button
            class="num-pad-clear"
            data-key="resetPrice"
            style="display: none"
          >
            Restaurar
          </button>
          <button class="num-pad-ok" data-key="ok">OK</button>
        </div>
      </div>
    </div>

    <!-- Teclado QWERTY -->
    <div id="qwertyOverlay" class="qwerty-overlay hidden">
      <div class="qwerty-pad">
        <div id="qwertyDisplay" class="qwerty-display"></div>

        <div class="qwerty-rows">
          <div
            class="qwerty-row qwerty-email-row hidden q-row"
            id="qwertyEmailRow"
          >
            <button class="q-key" data-key=".">.</button>
            <button class="q-key" data-key="_">_</button>
            <button class="q-key" data-key="-">-</button>
            <button class="q-key" data-key="@">@</button>
            <button class="q-key" data-key=".com">.com</button>
            <button class="q-key" data-key="gmail.com">gmail.com</button>
          </div>
          <div class="q-row">
            <button class="q-key" data-key="1">1</button>
            <button class="q-key" data-key="2">2</button>
            <button class="q-key" data-key="3">3</button>
            <button class="q-key" data-key="4">4</button>
            <button class="q-key" data-key="5">5</button>
            <button class="q-key" data-key="6">6</button>
            <button class="q-key" data-key="7">7</button>
            <button class="q-key" data-key="8">8</button>
            <button class="q-key" data-key="9">9</button>
            <button class="q-key" data-key="0">0</button>
          </div>
          <div class="q-row">
            <button class="q-key" data-key="q">Q</button>
            <button class="q-key" data-key="w">W</button>
            <button class="q-key" data-key="e">E</button>
            <button class="q-key" data-key="r">R</button>
            <button class="q-key" data-key="t">T</button>
            <button class="q-key" data-key="y">Y</button>
            <button class="q-key" data-key="u">U</button>
            <button class="q-key" data-key="i">I</button>
            <button class="q-key" data-key="o">O</button>
            <button class="q-key" data-key="p">P</button>
          </div>
          <div class="q-row">
            <button class="q-key" data-key="a">A</button>
            <button class="q-key" data-key="s">S</button>
            <button class="q-key" data-key="d">D</button>
            <button class="q-key" data-key="f">F</button>
            <button class="q-key" data-key="g">G</button>
            <button class="q-key" data-key="h">H</button>
            <button class="q-key" data-key="j">J</button>
            <button class="q-key" data-key="k">K</button>
            <button class="q-key" data-key="l">L</button>
            <button class="q-key" data-key="√±">√ë</button>
          </div>
          <div class="q-row">
            <button class="q-key" data-key="z">Z</button>
            <button class="q-key" data-key="x">X</button>
            <button class="q-key" data-key="c">C</button>
            <button class="q-key" data-key="v">V</button>
            <button class="q-key" data-key="b">B</button>
            <button class="q-key" data-key="n">N</button>
            <button class="q-key" data-key="m">M</button>
            <button class="q-key" data-key="-">-</button>
          </div>
        </div>

        <div class="qwerty-actions">
          <button class="q-btn q-back" data-key="back">‚Üê</button>
          <button class="q-btn q-clear" data-key="clear">Borrar todo</button>
          <button class="q-btn" data-key="space">Espacio</button>
          <button class="q-btn q-cancel" data-key="cancel">Cancelar</button>
          <button class="q-btn q-ok" data-key="ok">OK</button>
        </div>
      </div>
    </div>

    <!-- Overlay selecci√≥n de terminal / agente -->
    <div id="terminalOverlay" class="simple-overlay hidden">
      <div class="simple-dialog">
        <h2 id="terminalOverlayTitle">Seleccionar Terminal y Agente</h2>
        <p id="terminalOverlayDesc" style="margin-bottom: 8px; font-size: 14px">
          Elige el TPV y el agente que va a usar este equipo.
        </p>

        <!-- Wrapper terminal -->
        <div id="terminalSelectWrapper" style="margin-bottom: 8px">
          <label
            for="terminalSelect"
            style="font-size: 13px; display: block; margin-bottom: 4px"
          >
            Terminal TPV
          </label>
          <select
            id="terminalSelect"
            style="
              width: 100%;
              padding: 6px;
              border-radius: 4px;
              border: 1px solid #ccc;
            "
          >
            <!-- Se rellena desde JS -->
          </select>
        </div>

        <!-- Wrapper agente -->
        <div id="agentSelectWrapper" style="margin-bottom: 8px">
          <label
            for="agentButtonsOverlay"
            style="font-size: 13px; display: block; margin-bottom: 4px"
          >
            Agente / Cajero
          </label>
          <div
            id="agentButtonsOverlay"
            class="agent-button-bar agent-main-bar"
            style="display: flex; flex-wrap: wrap; gap: 8px"
          >
            <!-- Botones de agente generados por JS -->
          </div>
        </div>

        <div id="terminalError" class="dialog-error"></div>

        <div class="dialog-actions">
          <button id="terminalExitBtn">Salir</button>
          <button id="terminalOkBtn">Continuar</button>
        </div>
      </div>
    </div>

    <!-- Overlay: Tickets aparcados -->
    <div id="parkedTicketsOverlay" class="simple-overlay hidden">
      <div class="parked-modal">
        <header class="parked-modal-header">
          <h2>Tickets aparcados</h2>
          <button type="button" id="parkedCloseBtn" class="parked-close-btn">
            ‚úï
          </button>
        </header>

        <div class="parked-modal-body">
          <div id="parkedTicketsList"></div>
        </div>
      </div>
    </div>

    <!-- Overlay apertura / cierre de caja (ESTILO ‚ÄúPRIMERA IMAGEN‚Äù) -->
    <div id="cashOpenOverlay" class="simple-overlay hidden">
      <div class="cash-page-dialog">
        <div class="cash-page-header">
          <h2 id="cashDialogTitle">Apertura de caja</h2>
          <p class="cash-subtitle">
            Terminal: <strong><span id="cashOpenTerminalName"></span></strong>
          </p>
        </div>

        <!-- GRID billetes/monedas -->
        <div class="cash-grid-page">
          <!-- fila 1 -->
          <div class="cash-cell-page">
            <label>0,01 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="0.01"
            />
          </div>
          <div class="cash-cell-page">
            <label>0,02 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="0.02"
            />
          </div>
          <div class="cash-cell-page">
            <label>0,05 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="0.05"
            />
          </div>
          <div class="cash-cell-page">
            <label>0,10 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="0.10"
            />
          </div>

          <!-- fila 2 -->
          <div class="cash-cell-page">
            <label>0,20 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="0.20"
            />
          </div>
          <div class="cash-cell-page">
            <label>0,50 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="0.50"
            />
          </div>
          <div class="cash-cell-page">
            <label>1 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="1"
            />
          </div>
          <div class="cash-cell-page">
            <label>2 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="2"
            />
          </div>

          <!-- fila 3 -->
          <div class="cash-cell-page">
            <label>5 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="5"
            />
          </div>
          <div class="cash-cell-page">
            <label>10 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="10"
            />
          </div>
          <div class="cash-cell-page">
            <label>20 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="20"
            />
          </div>
          <div class="cash-cell-page">
            <label>50 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="50"
            />
          </div>

          <!-- fila 4 -->
          <div class="cash-cell-page">
            <label>100 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="100"
            />
          </div>
          <div class="cash-cell-page">
            <label>200 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="200"
            />
          </div>
          <div class="cash-cell-page">
            <label>500 ‚Ç¨</label>
            <input
              class="cash-hidden-input"
              type="number"
              min="0"
              step="1"
              value="0"
              data-denom="500"
            />
          </div>

          <!-- celda vac√≠a para cuadrar el grid en 4 columnas -->
          <div class="cash-cell-page cash-cell-empty"></div>
        </div>

        <!-- Observaciones -->
        <div class="cash-obs">
          <label for="cashObs">Observaciones</label>
          <textarea id="cashObs" rows="3" placeholder=""></textarea>
        </div>

        <!-- Resumen principal (igual que tu JS espera) -->
        <div class="cash-summary-page">
          <div class="cash-summary-item">
            <div class="cash-summary-label">Dinero inicial</div>
            <div class="cash-summary-value" id="sumOpening">0,00 ‚Ç¨</div>
          </div>

          <div class="cash-summary-item">
            <div class="cash-summary-label">Ingresos en efectivo</div>
            <div class="cash-summary-value" id="sumCashIncome">0,00 ‚Ç¨</div>
          </div>

          <div class="cash-summary-item">
            <div class="cash-summary-label">Total movimientos</div>
            <div class="cash-summary-value" id="sumMovements">0,00 ‚Ç¨</div>
          </div>

          <div class="cash-summary-item">
            <div class="cash-summary-label">Total en caja</div>
            <div class="cash-summary-value" id="sumExpectedCash">0,00 ‚Ç¨</div>
          </div>

          <div class="cash-summary-item">
            <div class="cash-summary-label">Conteo de caja</div>
            <div class="cash-summary-value" id="sumCountedCash">0,00 ‚Ç¨</div>
          </div>

          <div class="cash-summary-item">
            <div class="cash-summary-label">Diferencia</div>
            <div class="cash-summary-value" id="sumDifference">0,00 ‚Ç¨</div>
          </div>

          <div class="cash-summary-item">
            <div class="cash-summary-label">Total ventas</div>
            <div class="cash-summary-value" id="sumTotalSales">0,00 ‚Ç¨</div>
          </div>
        </div>

        <!-- Total grande (tu JS usa cashOpenTotalEl) -->
        <div class="cash-total-big">
          <span id="cashSummaryMainLabel">Dinero Asignado:</span>
          <strong id="cashOpenTotal">0,00 ‚Ç¨</strong>
        </div>
        <!-- üîΩ NUEVO: resumen por formas de pago (solo se rellena en cierre) -->
        <div id="cashCloseSummary" style="display: none">
          <div id="payMethodsSummary" class="cash-paymethods-cards"></div>
        </div>

        <!-- Acciones -->
        <div class="cash-actions-page">
          <button id="cashOpenCancelBtn" type="button" class="btn-cash-cancel">
            Cancelar
          </button>
          <button id="cashOpenOkBtn" type="button" class="btn-cash-ok">
            Guardar
          </button>
        </div>
      </div>
    </div>

    <!-- Overlay: Nuevo movimiento de caja -->
    <div id="cashMoveOverlay" class="simple-overlay hidden">
      <div class="simple-dialog cash-move-dialog">
        <!-- Cabecera -->
        <div class="cash-move-header">
          <h2>Nuevo movimiento de caja</h2>
          <button type="button" id="cashMoveCloseX" class="cash-move-close">
            ‚úï
          </button>
        </div>

        <!-- Cuerpo -->
        <div class="cash-move-body">
          <!-- Cantidad -->
          <label for="cashMoveAmount" class="cash-move-label">Cantidad</label>
          <div class="cash-move-amount-row">
            <div class="cash-move-amount-wrap">
              <input
                id="cashMoveAmount"
                type="number"
                min="0"
                step="1"
                inputmode="decimal"
                class="cash-move-input"
              />
              <span class="cash-move-euro">‚Ç¨</span>
            </div>
            <button
              type="button"
              id="cashMoveAmountKeyboardBtn"
              class="cash-move-key-btn"
              title="Teclado num√©rico"
            >
              üî¢
            </button>
          </div>

          <!-- Tipo -->
          <div class="cash-move-type">
            <div class="cash-move-label">Tipo</div>
            <label class="cash-move-radio">
              <input type="radio" name="cashMoveType" value="in" checked />
              <span>Entrada de dinero</span>
            </label>
            <label class="cash-move-radio">
              <input type="radio" name="cashMoveType" value="out" />
              <span>Salida de dinero</span>
            </label>
          </div>

          <!-- Motivo -->
          <div class="cash-move-reason">
            <label for="cashMoveReason" class="cash-move-label">Motivo</label>
            <div class="cash-move-reason-row">
              <textarea
                id="cashMoveReason"
                rows="3"
                class="cash-move-textarea"
                placeholder="Ej: cambio inicial, ingreso en banco, pago proveedor..."
              ></textarea>
              <button
                type="button"
                id="cashMoveReasonKeyboardBtn"
                class="cash-move-key-btn"
                title="Teclado de texto"
              >
                ‚å®Ô∏è
              </button>
            </div>
          </div>

          <div id="cashMoveError" class="dialog-error"></div>
        </div>

        <!-- Acciones -->
        <div class="dialog-actions cash-move-actions">
          <button id="cashMoveCancelBtn" type="button">Cancelar</button>
          <button id="cashMoveSaveBtn" type="button">Guardar</button>
        </div>
      </div>
    </div>

    <!-- Overlay apertura de caja -->

    <div id="emailOverlay" class="email-overlay hidden">
      <div class="email-modal">
        <h2>Activar TPV</h2>
        <p>Introduce el email de tu empresa</p>

        <input id="emailInput" type="email" placeholder="tu@email.com" />
        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 8px;
          "
        >
          <button id="emailKeyboardBtn" type="button">‚å® Teclado</button>
        </div>
        <div class="email-actions">
          <button id="emailCancelBtn" type="button">Cancelar</button>
          <button id="emailOkBtn" type="button">Continuar</button>
        </div>

        <div id="emailError" class="email-error"></div>
      </div>
    </div>
    <div id="msgOverlay" class="simple-overlay critical-overlay hidden">
      <div class="simple-dialog">
        <h2 id="msgTitle">Aviso</h2>
        <p id="msgText" style="margin: 10px 0; font-size: 14px"></p>
        <div class="dialog-actions">
          <button id="msgCancelBtn">Cancelar</button>
          <button id="msgOkBtn">Aceptar</button>
        </div>
      </div>
    </div>

    <div id="printerOverlay" class="simple-overlay hidden">
      <div class="simple-dialog">
        <h2>Seleccionar impresora</h2>
        <p style="margin-bottom: 8px; font-size: 14px">
          Elige la impresora de tickets (se guardar√° para pr√≥ximas impresiones).
        </p>

        <select
          id="printerSelect"
          style="
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        >
          <!-- opciones por JS -->
        </select>

        <div id="printerError" class="dialog-error"></div>

        <div class="dialog-actions">
          <button id="printerCancelBtn">Cancelar</button>
          <button id="printerOkBtn">Guardar</button>
        </div>
      </div>
    </div>

    <!-- Overlay Cobrar (estilo FacturaScripts) -->
    <div id="payOverlay" class="simple-overlay hidden">
      <div class="pay-modal">
        <header class="pay-header">
          <h2 style="margin: 0">Cobrar</h2>
          <button type="button" id="payCloseX" class="pay-x">‚úï</button>
        </header>

        <div class="pay-top">
          <div class="pay-top-box">
            <div class="pay-top-value" id="payTotalBig">0,00 ‚Ç¨</div>
            <div class="pay-top-label">Total</div>
          </div>
          <div class="pay-top-box">
            <div class="pay-top-value" id="payChangeBig">0,00 ‚Ç¨</div>
            <div class="pay-top-label">Cambio</div>
          </div>
        </div>

        <div class="pay-body">
          <!-- IZQUIERDA: m√©todos + campos -->
          <div class="pay-left">
            <div class="pay-section-title">Formas de pago</div>

            <div id="payMethodsList" class="pay-methods-list">
              <!-- filas din√°micas por JS -->
            </div>

            <div class="pay-extra">
              <div class="pay-extra-row">
                <div class="pay-extra-col">
                  <label class="pay-label">N√∫mero</label>
                  <input id="payNumber" class="pay-input" placeholder="" />
                </div>

                <div class="pay-extra-col">
                  <label class="pay-label">Serie</label>
                  <select id="paySerie" class="pay-input">
                    <option value="">Simplificadas</option>
                  </select>
                </div>
              </div>

              <label class="pay-label" style="margin-top: 10px"
                >Observaciones</label
              >
              <textarea id="payObs" class="pay-textarea" rows="3"></textarea>
            </div>

            <div
              id="payError"
              class="dialog-error"
              style="margin-top: 8px"
            ></div>

            <div class="pay-footer-left">
              <button
                type="button"
                id="payOpenDrawerBtn"
                class="pay-btn pay-btn-blue"
              >
                üßæ Abrir caj√≥n
              </button>
            </div>
          </div>

          <!-- DERECHA: teclado num√©rico -->
          <div class="pay-right">
            <div class="pay-keypad">
              <button class="pay-key" data-k="7">7</button>
              <button class="pay-key" data-k="8">8</button>
              <button class="pay-key" data-k="9">9</button>

              <button class="pay-key" data-k="4">4</button>
              <button class="pay-key" data-k="5">5</button>
              <button class="pay-key" data-k="6">6</button>

              <button class="pay-key" data-k="1">1</button>
              <button class="pay-key" data-k="2">2</button>
              <button class="pay-key" data-k="3">3</button>

              <button class="pay-key" data-k="0">0</button>
              <button class="pay-key" data-k="00">00</button>
              <button class="pay-key" data-k=".">.</button>

              <!-- columna acciones (como la imagen) -->
              <button class="pay-key pay-key-yellow" data-k="back">‚å´</button>
              <button class="pay-key pay-key-red" data-k="clear">C</button>
            </div>

            <div class="pay-footer-right">
              <button id="payCancelBtn" class="pay-btn" type="button">
                Cancelar
              </button>
              <button
                id="paySaveBtn"
                class="pay-btn pay-btn-green"
                type="button"
              >
                Confirmar Pago
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Overlay: Listado de tickets -->
    <div id="ticketsOverlay" class="simple-overlay hidden">
      <div class="parked-modal">
        <header class="parked-modal-header">
          <h2>Tickets</h2>
          <button type="button" id="ticketsCloseBtn" class="parked-close-btn">
            ‚úï
          </button>
        </header>

        <div class="parked-modal-body">
          <div class="tickets-tools">
            <input
              id="ticketsSearch"
              type="text"
              placeholder="Buscar (n¬∫, cliente, total...)"
              autocomplete="off"
            />

            <button
              id="ticketsKeyboardBtn"
              type="button"
              class="cart-btn"
              title="Teclado"
            >
              ‚å®
            </button>

            <button id="ticketsReloadBtn" type="button" class="cart-btn">
              Recargar
            </button>
          </div>

          <div id="ticketsList"></div>
        </div>
      </div>
    </div>

    <!-- Overlay: Devoluci√≥n -->
    <div id="refundOverlay" class="simple-overlay hidden">
      <div class="pay-modal" style="max-width: 920px">
        <header class="pay-header">
          <h2 style="margin: 0">Devoluci√≥n</h2>
          <button type="button" id="refundCloseX" class="pay-x">‚úï</button>
        </header>

        <div style="padding: 12px 14px; font-size: 14px">
          <div
            style="
              display: flex;
              justify-content: space-between;
              gap: 12px;
              flex-wrap: wrap;
            "
          >
            <div>Ticket: <strong id="refundTicketNum">‚Äî</strong></div>
            <div>Cliente: <strong id="refundClient">‚Äî</strong></div>
            <div>Total ticket: <strong id="refundTicketTotal">‚Äî</strong></div>
          </div>

          <div
            style="
              margin-top: 12px;
              border-top: 1px solid #ddd;
              padding-top: 10px;
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                flex-wrap: wrap;
              "
            >
              <strong>L√≠neas</strong>
              <div style="display: flex; gap: 8px">
                <button id="refundSelectAllBtn" type="button" class="cart-btn">
                  Todo
                </button>
                <button id="refundSelectNoneBtn" type="button" class="cart-btn">
                  Nada
                </button>
              </div>
            </div>

            <div id="refundLines" style="margin-top: 10px"></div>

            <div
              style="
                margin-top: 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                flex-wrap: wrap;
              "
            >
              <div>
                Importe a devolver: <strong id="refundAmount">0,00 ‚Ç¨</strong>
              </div>
              <div style="display: flex; gap: 10px">
                <button id="refundCancelBtn" class="pay-btn" type="button">
                  Cancelar
                </button>
                <button
                  id="refundConfirmBtn"
                  class="pay-btn pay-btn-green"
                  type="button"
                >
                  Confirmar devoluci√≥n
                </button>
              </div>
            </div>

            <div
              id="refundError"
              class="dialog-error"
              style="margin-top: 10px"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Overlay: Post-cobro -->
    <div id="postPayOverlay" class="simple-overlay hidden">
      <div
        class="simple-dialog postpay-dialog"
        style="width: 520px; max-width: 94vw"
      >
        <div class="postpay-head">
          <h2 style="margin: 0">Opciones del ticket</h2>
          <button type="button" id="postPayCloseX" class="small-btn">‚úï</button>
        </div>

        <div class="postpay-summary">
          <div class="postpay-kpi">
            <div class="postpay-kpi-val" id="postPayDoc">‚Äî</div>
            <div class="postpay-kpi-lbl">Documento</div>
          </div>
          <div class="postpay-kpi">
            <div class="postpay-kpi-val" id="postPayTotal">0,00 ‚Ç¨</div>
            <div class="postpay-kpi-lbl">Total</div>
          </div>
          <div class="postpay-kpi">
            <div class="postpay-kpi-val" id="postPayChange">0,00 ‚Ç¨</div>
            <div class="postpay-kpi-lbl">Cambio</div>
          </div>
        </div>

        <div class="postpay-actions">
          <button
            type="button"
            id="postPayPrintBtn"
            class="pay-btn pay-btn-blue"
          >
            üßæ Imprimir ticket
          </button>

          <button type="button" id="postPayOpenDrawerBtn" class="pay-btn">
            üóÑÔ∏è Abrir caj√≥n
          </button>
        </div>

        <div class="postpay-autoclose" id="postPayAutoCloseText"></div>
      </div>
    </div>

    <!-- Overlay: Confirmar cierre de caja -->
<div id="cashCloseConfirmOverlay" class="simple-overlay hidden">
  <div class="simple-dialog" style="width: 520px; max-width: 94vw">
    <div style="display:flex; align-items:center; justify-content:space-between;">
      <h2 style="margin:0">Confirmar cierre de caja</h2>
      <button type="button" id="cashCloseConfirmCloseX" class="small-btn">‚úï</button>
    </div>

    <div id="cashCloseConfirmText" style="margin-top:10px; font-size:13px; opacity:0.9; white-space:pre-line;">
      ¬øSeguro que quieres cerrar la caja?
    </div>

    <div
      class="dialog-actions"
      style="margin-top: 16px; display:flex; gap:10px; justify-content:flex-end;"
    >
      <button type="button" id="cashCloseConfirmCancelBtn">Cancelar</button>
      <button type="button" id="cashCloseConfirmOkBtn" class="pay-btn pay-btn-blue">
        S√≠, cerrar caja
      </button>
    </div>
  </div>
</div>

    <!-- Overlay: Opciones -->
    <div id="optionsOverlay" class="simple-overlay hidden">
      <div class="simple-dialog" style="width: 520px; max-width: 94vw">
        <div
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
          "
        >
          <h2 style="margin: 0">Opciones</h2>
          <button type="button" id="optionsCloseX" class="small-btn">‚úï</button>
        </div>

        <div
          style="
            margin-top: 16px;
            border-top: 1px solid #eee;
            padding-top: 12px;
          "
        >
          <div style="font-weight: 700; margin-bottom: 6px">Caja</div>

          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 10px;
              flex-wrap: wrap;
            "
          >
            <div style="font-size: 13px; opacity: 0.85">
              Abrir caj√≥n con todos los pagos
            </div>

            <label class="switch">
              <input type="checkbox" id="openDrawerAlwaysToggle" />
              <span class="slider"></span>
            </label>
          </div>

          <div style="font-size: 12px; opacity: 0.7; margin-top: 6px">
            Si lo desactivas, el caj√≥n solo se abrir√° con pagos en efectivo.
          </div>
        </div>

        <div data-admin-only>
          <div
            style="
              margin-top: 16px;
              border-top: 1px solid #eee;
              padding-top: 12px;
            "
          >
            <div style="font-weight: 700; margin-bottom: 6px">Pantalla</div>

            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
                flex-wrap: wrap;
              "
            >
              <div style="font-size: 13px; opacity: 0.85">Modo TPV (kiosk)</div>

              <label class="switch">
                <input type="checkbox" id="kioskToggle" />
                <span class="slider"></span>
              </label>
            </div>

            <div style="font-size: 12px; opacity: 0.7; margin-top: 6px">
              Si desactivas, podr√°s minimizar y usar el equipo como un PC
              normal.
            </div>
          </div>
        </div>

        <div style="margin-top: 12px">
          <div style="font-weight: 700; margin-bottom: 6px">Impresora</div>

          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 10px;
              flex-wrap: wrap;
            "
          >
            <div style="font-size: 13px; opacity: 0.85">
              Impresora actual: <strong id="currentPrinterName">‚Äî</strong>
            </div>

            <div style="display: inline-flex; gap: 8px; align-items: center">
              <button
                type="button"
                id="optionsChangePrinterBtn"
                class="small-btn"
              >
                Cambiar
              </button>

              <button
                type="button"
                id="optionsTestPrinterBtn"
                class="small-btn"
                style="display: none; opacity: 0.9"
              >
                Probar
              </button>
            </div>
          </div>
        </div>

        <div
          style="
            margin-top: 16px;
            border-top: 1px solid #eee;
            padding-top: 12px;
          "
        >
          <div style="font-weight: 700; margin-bottom: 6px">Impresi√≥n</div>

          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 10px;
              flex-wrap: wrap;
            "
          >
            <div style="font-size: 13px; opacity: 0.85">
              Imprimir autom√°ticamente al cobrar
            </div>

            <label class="switch">
              <input type="checkbox" id="autoPrintToggle" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div
          style="
            margin-top: 16px;
            border-top: 1px solid #eee;
            padding-top: 12px;
          "
        >
          <div style="font-weight: 700; margin-bottom: 6px">Carrito</div>

          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 10px;
              flex-wrap: wrap;
            "
          >
            <div style="font-size: 13px; opacity: 0.85">Desagrupar l√≠neas</div>

            <label class="switch">
              <input type="checkbox" id="groupLinesToggle" />
              <span class="slider"></span>
            </label>
          </div>

          <div style="font-size: 12px; opacity: 0.7; margin-top: 6px">
            Si activas, cada toque crea una l√≠nea nueva aunque sea el mismo
            producto.
          </div>
        </div>

        <div
          style="
            margin-top: 16px;
            border-top: 1px solid #eee;
            padding-top: 12px;
          "
        >
          <div style="font-weight: 700; margin-bottom: 6px">
            Apertura de caj√≥n
          </div>

          <div
            style="
              display: flex;
              align-items: center;
              justify-content: space-between;
              gap: 10px;
              flex-wrap: wrap;
            "
          >
            <div style="font-size: 13px; opacity: 0.85">
              Abrir el caj√≥n manualmente
            </div>

            <button
              type="button"
              id="optionsOpenDrawerBtn"
              class="pay-btn pay-btn-blue"
            >
              üßæ Abrir caj√≥n
            </button>
          </div>

          <div style="font-size: 12px; opacity: 0.7; margin-top: 6px">
            Se usa la impresora seleccionada para enviar la se√±al al caj√≥n.
          </div>
        </div>

        <div
          class="dialog-actions"
          style="
            margin-top: 16px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
          "
        >
          <button type="button" id="optionsQuitBtn" class="pay-btn pay-btn-red">
            Salir del Programa
          </button>
          <button type="button" id="optionsCloseBtn">Cerrar Opciones</button>
        </div>
      </div>
    </div>

    <!-- Overlay: Login -->
    <div id="loginOverlay" class="simple-overlay hidden">
      <div class="simple-dialog" style="width: 520px; max-width: 94vw">
        <h2>Iniciar sesi√≥n</h2>
        <p style="margin: 6px 0 12px; font-size: 14px; opacity: 0.85">
          Elige tu usuario y escribe el pin asignado.
        </p>

        <div style="font-size: 13px; font-weight: 700; margin-bottom: 6px">
          Usuario
        </div>

        <div
          id="loginUsersBar"
          class="agent-main-bar"
          style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px"
        >
          <!-- botones por JS -->
        </div>

        <div style="font-size: 13px; display: block; margin: 10px 0 4px">
          Pin (Max 4)
        </div>
        <input
          id="loginPass"
          type="password"
          autocomplete="current-password"
          inputmode="numeric"
          maxlength="4"
          style="
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
          "
        />
        <div class="login-pin-wrap">
          <div class="login-pin-pad" id="loginPinPad">
            <button type="button" class="pin-key" data-k="1">1</button>
            <button type="button" class="pin-key" data-k="2">2</button>
            <button type="button" class="pin-key" data-k="3">3</button>
            <button type="button" class="pin-key" data-k="4">4</button>
            <button type="button" class="pin-key" data-k="5">5</button>
            <button type="button" class="pin-key" data-k="6">6</button>
            <button type="button" class="pin-key" data-k="7">7</button>
            <button type="button" class="pin-key" data-k="8">8</button>
            <button type="button" class="pin-key" data-k="9">9</button>

            <button type="button" class="pin-key pin-key-warn" data-k="clear">
              C
            </button>
            <button type="button" class="pin-key" data-k="0">0</button>
            <button type="button" class="pin-key pin-key-fn" data-k="back">
              ‚å´
            </button>
          </div>
        </div>

        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 8px;
          "
        ></div>

        <div
          id="loginError"
          class="dialog-error"
          style="margin-top: 10px"
        ></div>

        <div class="dialog-actions">
          <button id="loginExitBtn">Salir</button>
          <button id="loginOkBtn">Entrar</button>
        </div>
      </div>
    </div>

    <!-- Overlay: Aparcar con observaciones -->
    <div id="parkObsOverlay" class="simple-overlay hidden">
      <div class="simple-dialog" style="width: 520px; max-width: 94vw">
        <h2 style="margin-top: 0">Aparcar ticket</h2>

        <label
          style="
            font-size: 13px;
            font-weight: 600;
            display: block;
            margin: 8px 0 6px;
          "
        >
          Observaciones (opcional)
        </label>

        <input
          id="parkObsInput"
          type="text"
          placeholder="Ej: Mesa 3, para llevar, sin gluten..."
          style="
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
          "
          autocomplete="off"
        />

        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 10px;
          "
        >
          <button id="parkObsKeyboardBtn" type="button" class="cart-btn">
            ‚å® Teclado
          </button>
        </div>

        <div class="dialog-actions">
          <button id="parkObsCancelBtn">Cancelar</button>
          <button id="parkObsOkBtn">Aparcar</button>
        </div>
      </div>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <script src="config.js"></script>

    <script src="renderer.js"></script>
    <script>
      window.addEventListener("keydown", (e) => {
        const key = (e.key || "").toLowerCase();
        if (e.ctrlKey && e.altKey && key === "q") {
          e.preventDefault();
          window.TPV_SYS?.quit?.();
        }
      });
    </script>
  </body>
</html>
